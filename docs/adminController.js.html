<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: adminController.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: adminController.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Contrôleur pour la création d'utilisateurs et d'événements en tant qu'administrateur.
 * @module Contrôleur/Admin
 */


const fi = require('../public/javascripts/index/fonctions_inscription');
const cu = require('../public/javascripts/admin/creerUser');
const ce = require('../public/javascripts/admin/creerEvent');
const fmdp = require('../public/javascripts/index/fonctions_mdp');


async function createUser(req, res) {
  if (req.method === 'GET') {
    res.render('admin/creerUser', { title: 'Créer user' });
  } else if (req.method === 'POST') {

    const {
      type: type,
      nom: userNom,
      prenom: userPrenom,
      pseudo: userPseudo,
      email: userMail,
      linkedin: userLinkedin,
      github: userGitHub,
      ville: userVille,
      ecole: userEcole,
      codeEcole: userCodeEcole,
      niveau_etude: userNiveauEtude,
      password,
      entreprise: userEntreprise,
      metier: userMetier,
      role_asso: userRole
    } = req.body;

    const valeurs_communes = [
      userNom,
      userPrenom,
      userPseudo,
      userMail,
      userLinkedin,
      userGitHub,
      userVille,
    ]

    const valeurs_id = [
      userPseudo,
      userMail
    ]

    const valeurs_etudiant = [
      userEcole,
      userCodeEcole,
      userNiveauEtude
    ]

    switch (type) {
      case 'administrateur':
        cu.creerAdmin(valeurs_communes, valeurs_id)
          .then((result) => {
            if (result === 'true') {
              fmdp.salageMdp(password)
                .then((hashedPassword) => {
                  console.log('Mot de passe crypté avec succès');
                  fi.insererMdp(hashedPassword, userPseudo);
                  res.status(200).json({ message: 'Inscription réussie' });
                })
                .catch((error) => {
                  console.error('Erreur lors du salage du mot de passe (Création admin)', error);
                  res.status(400).json({ message: 'Erreur lors du salage du mot de passe (Création admin)' });
                });
            } else if (result === 'les2') {
              console.error('Pseudo et email pris');
              res.status(400).json({ message: 'Pseudo et email pris' });
            } else if (result === 'pseudo') {

              console.error('Pseudo pris');
              res.status(400).json({ message: 'Pseudo pris' });
            } else if (result === 'mail') {

              console.error('Email pris');
              res.status(400).json({ message: 'Email pris' });

            } else {
              console.error('Erreur lors de la création de l\'admin');
              res.status(400).json({ message: 'Erreur lors de la création de l\'admin' });
            }

          });

        break;

      case 'etudiant':
        cu.creerEtudiant(valeurs_communes, valeurs_id, userEcole, userCodeEcole, userNiveauEtude)
          .then((result) => {
            if (result === 'true') {
              fmdp.salageMdp(password)
                .then((hashedPassword) => {
                  console.log('Mot de passe crypté avec succès');
                  fi.insererMdp(hashedPassword, userPseudo);
                  res.status(200).json({ message: 'Inscription réussie' });
                })
                .catch((error) => {
                  console.error('Erreur lors du salage du mot de passe (Création admin)', error);
                  res.status(400).json({ message: 'Erreur lors du salage du mot de passe (Création admin)' });
                });
            } else if (result === 'les2') {
              console.error('Pseudo et email pris');
              res.status(400).json({ message: 'Pseudo et email pris' });
            } else if (result === 'pseudo') {

              console.error('Pseudo pris');
              res.status(400).json({ message: 'Pseudo pris' });
            } else if (result === 'mail') {

              console.error('Email pris');
              res.status(400).json({ message: 'Email pris' });

            } else {
              console.error('Erreur lors de la création de l\'admin');
              res.status(400).json({ message: 'Erreur lors de la création de l\'admin' });
            }

          });

        break;

      case 'gestionnaire_iapau':
        cu.creerGestionnaireIA(valeurs_communes, valeurs_id, userRole)
          .then((result) => {
            if (result === 'true') {
              fmdp.salageMdp(password)
                .then((hashedPassword) => {
                  console.log('Mot de passe crypté avec succès');
                  fi.insererMdp(hashedPassword, userPseudo);
                  res.status(200).json({ message: 'Inscription réussie' });
                })
                .catch((error) => {
                  console.error('Erreur lors du salage du mot de passe (Création admin)', error);
                  res.status(400).json({ message: 'Erreur lors du salage du mot de passe (Création admin)' });
                });
            } else if (result === 'les2') {
              console.error('Pseudo et email pris');
              res.status(400).json({ message: 'Pseudo et email pris' });
            } else if (result === 'pseudo') {

              console.error('Pseudo pris');
              res.status(400).json({ message: 'Pseudo pris' });
            } else if (result === 'mail') {

              console.error('Email pris');
              res.status(400).json({ message: 'Email pris' });

            } else {
              console.error('Erreur lors de la création de l\'admin');
              res.status(400).json({ message: 'Erreur lors de la création de l\'admin' });
            }

          });

        break;

      case 'gestionnaire_externe':
        cu.creerGestionnaireExterne(valeurs_communes, valeurs_id, userEntreprise, userMetier)
          .then((result) => {
            if (result === 'true') {
              fmdp.salageMdp(password)
                .then((hashedPassword) => {
                  console.log('Mot de passe crypté avec succès');
                  fi.insererMdp(hashedPassword, userPseudo);
                  res.status(200).json({ message: 'Inscription réussie' });
                })
                .catch((error) => {
                  console.error('Erreur lors du salage du mot de passe (Création admin)', error);
                  res.status(400).json({ message: 'Erreur lors du salage du mot de passe (Création admin)' });
                });
            } else if (result === 'les2') {
              console.error('Pseudo et email pris');
              res.status(400).json({ message: 'Pseudo et email pris' });
            } else if (result === 'pseudo') {

              console.error('Pseudo pris');
              res.status(400).json({ message: 'Pseudo pris' });
            } else if (result === 'mail') {

              console.error('Email pris');
              res.status(400).json({ message: 'Email pris' });

            } else {
              console.error('Erreur lors de la création de l\'admin');
              res.status(400).json({ message: 'Erreur lors de la création de l\'admin' });
            }

          });

      default:
        break;
    }
  }
}

function createEvent(req, res) {
  if (req.method === 'GET') {
    res.render('admin/creerEvent', { title: 'Créer Event' });
  } else if (req.method === 'POST') {

    const {
      typeEvent,
      nomEvent,
      dateInscription,
      dateDebut,
      dateFin,
      dateResultat,
      regles,
      nbEquipeMin,
      nbEquipeMax,
      imageEvent,

    } = req.body;

    const valeurs_event = [
      typeEvent,
      nomEvent,
      dateInscription,
      dateDebut,
      dateFin,
      dateResultat,
      regles,
      nbEquipeMin,
      nbEquipeMax,
      imageEvent
    ]

    const { projet, ressources } = req.body;

    // Traiter les données et les enregistrer dans la base de données

    // Exemple : afficher les tableaux dans la console
    console.log('Tableau des projets :', projet);
    console.log('Tableau des ressources :', ressources);
    console.log('Tableau des events: ', valeurs_event);


    // try{
    //   ce.creerEvent(nomEvent);
    //   //res.status(200).json({message:'Carré'});
    // }
    // catch{
    //   console.log('Erreur dans la création d\'un event');
    //   //es.status(400).json({message:'Erreur lors de la création d\'un event'});
    // }

    //   // .then(()=> {
    //   //   res.status(200).json({message:'Carré'});

    //   // })
    //   // .catch((err)=> {
    //   //   console.log('Erreur dans la création d\'un event');
    //   //   res.status(400).json({message:'Erreur lors de la création d\'un event'});

    //   // })
  }
}

module.exports = {
  createUser,
  createEvent
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-Contr%25C3%25B4leur_Admin.html">Contrôleur/Admin</a></li><li><a href="module-fonctions_mdp.html">fonctions_mdp</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Mon Jul 03 2023 12:04:20 GMT+0200 (Central European Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
